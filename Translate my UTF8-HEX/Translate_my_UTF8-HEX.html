<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>TrHexUTF8</title>
<link rel="stylesheet" href="css/style.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
<script src="https://cdn.rawgit.com/zenorocha/clipboard.js/master/dist/clipboard.min.js"></script>
<script type="text/javascript">
	function cyrill_to_latin(text){
		var arr1 = Array ('Я','я','Ю','ю','Ч','ч','Ш','ш','Щ','щ','Ж','ж','А','а','Б','б','В','в','Г','г','Д','д','Е','е','Ё','ё','З','з','И','и','Й','й','К','к','Л','л','М','м','Н','н', 'О','о','П','п','Р','р','С','с','Т','т','У','у','Ф','ф','Х','х','Ц','ц','Ы','ы','Ь','ь','Ъ','ъ','Э','э');
		var arr2 = Array ('Я','я','Ю','ю','Ч','ч','Ш','ш','Щ','щ','Ж','ж','A','a','Б','б','B','в','Г','г','Д','д','E','e','E','e','3','з','И','u','Й','й','K','к','Л','л','M','м','H','н', 'O','o','П','п','P','p','C','c','T','т','У','y','Ф','ф','X','x','Ц','ц','Ы','ы','Ь','b','Ъ','ъ','Э','э');

		for(var i=0; i<arr1.length; i++){
			var reg = new RegExp(arr1[i], "g");
			text = text.replace(reg, arr2[i]);
	    }
		return text;
	}

	function getXMLNodeText(node){
	return node.text || node.textContent;
	}

	function translit(){
		$("[name=result]").val(cyrill_to_latin($("[name=translit]").val()));
		btLength();
	}

	function translater(){
		var apiUrl = 'https://translate.yandex.net/api/v1.5/tr/translate?key=trnsl.1.1.20170219T103517Z.b509ba86abcca008.caf7be4afec785f83c167b395390cc436502ee40&text='+$("[name=original]").val()+'&lang=en-ru&format=plain';
		
		$.ajax({
			url: apiUrl,
			type: 'GET',
			dataType: 'html',
			success: function(d){
				$(d).find('text').each(function(){
					$("[name=translit]").val( $(this).text() );
					translit();
				})
			}
		});
	}

	function byteLength(str){
	   var length = str.length;
	   var count = 0;
	   var i = 0;
	   var ch = 0;
	   for(i; i < length; i++){
	     ch = str.charCodeAt(i);
	     if(ch <= 127){
	        count++;
	     }else if(ch <= 2047){
	        count += 2;
	     }else if(ch <= 65535){
	        count += 3;
	     }else if(ch <= 2097151){
	        count += 4;
	     }else if(ch <= 67108863){
	        count += 5;
	     }else{
	        count += 6;
	     }    
	  }
	  return count;
	};

	function btLength(){
		var copy = $("[name=result]")[0].value;
		var strO = unescape(encodeURIComponent($("[name=original]")[0].value)).length;
		var strR = unescape(encodeURIComponent($("[name=result]")[0].value)).length;
		diff = strO - strR;
		if (diff === 0) {alert('Тютелька в тютельку!!!');}
		else if (diff > 0) {alert('Остался запас в '+diff+' байт');}
		else if (diff < 0) {alert('Надо уменьшить на '+ -1*diff +' байт');}
	}
</script>
</head>
<body>

<fieldset>
    <legend>Результат</legend>	
	<p><textarea class="demo2_text" placeholder="Введите текст оригинала" name="original" style="width: 750px; height: 150px;"></textarea></p>
	<p><textarea class="demo2_text" placeholder="Введите русский текст" name="translit" style="width: 750px; height: 150px;"></textarea></p>
	<p><textarea class="demo2_translit" name="result" id="inputId" style="width: 750px; height: 150px;"></textarea></p>
	<input onclick="translater();" type="button" value="Перевести оригинал" /> 
	<input onclick="translit();" type="button" value="Конвертировать перевод" data-clipboard-target="#inputId" id="buttonId1" /> 
	<input onclick="btLength();" type="button" value="Сравнить длинну побайтово" data-clipboard-target="#inputId" id="buttonId2" />

<script>
	new ClipboardJS('#buttonId1, #buttonId2');
</script>
</fieldset> 

</body>
</html>


